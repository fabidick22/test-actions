name: "Workflow Dispatcher"

on:
  workflow_dispatch:
    inputs:
      env:
        type: environment
        required: true
        description: "Environment"
      dry_run:
        type: boolean
        required: false
        default: false
        description: Dry run mode

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout branch
        uses: actions/checkout@v2

      - name: Debug
        run: echo "${{ toJSON(github) }}"

      - name: Debug
        if: github.event.inputs.dry_run == 'false'
        run: echo "${{ github.event.inputs.dry_run }}"

      - name: Debug
        if: github.event.inputs.dry_run == false
        run: echo "${{ github.event.inputs.dry_run }}"

      - uses: ministryofjustice/setup-git-crypt@main

      - name: Debug 3
        run: git-crypt --version

      - name: Unlock secrets
        uses: sliteteam/github-action-git-crypt-unlock@1.2.0
        env:
          GIT_CRYPT_KEY: ${{ secrets.GIT_CRYPT_KEY }}

      - name: Debug 3
        run: git-crypt --version
